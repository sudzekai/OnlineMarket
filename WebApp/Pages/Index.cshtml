@page
@model IndexModel
@{
    ViewData["Title"] = "Каталог";
}

<div class="flex-column gap-1 bg-light border-1 rounded-4 shadow-sm p-3 sticky-top mb-3">
    <form method="get">
        <div class="d-inline-flex w-100 gap-3 align-items-center">
            <h1>Каталог</h1>
            <input asp-for="SearchBarText" class="form-control h-25 rounded-4" type="text" placeholder="Найти в каталоге..." /> <!-- Поиск -->
            <button type="submit" style="display: none;"></button>
        </div>
        <div class="d-inline-flex w-100 gap-2 align-items-center">
            <div class="dropdown form-control p-0 m-0 flex-grow-1 rounded-4 h-25 form-select">
                <button class="btn w-100 d-flex align-items-center rounded-4"
                        id="dropdownMenuButton"
                        data-bs-toggle="dropdown">
                    Цена
                </button>

                <ul class="dropdown-menu w-100 rounded-4 shadow-sm p-2" aria-labelledby="dropdownMenuButton"> <!-- Фильтр по цене -->
                    <li onclick="event.stopPropagation();">
                        <div class="d-flex flex-column gap-2">
                            <div class="d-inline-flex gap-2">
                                <div class="d-flex flex-column gap-1 flex-grow-1">
                                    <label class="ms-2">От</label>
                                    <div class="input-group">
                                        <input class="form-control rounded-start-4 border-end-0" asp-for="@Model.PriceMin" />
                                        <span class="input-group-text bg-white border-start-0 rounded-end-4 text-muted">₽</span>
                                    </div>
                                </div>

                                <div class="d-flex flex-column gap-1 flex-grow-1">
                                    <label class="ms-2">До</label>
                                    <div class="input-group">
                                        <input class="form-control rounded-start-4 border-end-0" asp-for="@Model.PriceMax" />
                                        <span class="input-group-text bg-white border-start-0 rounded-end-4 text-muted">₽</span>
                                    </div>
                                </div>
                            </div>

                            <button class="btn btn-primary form-control rounded-4" type="submit">Применить</button>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="form-control rounded-4 d-inline-flex justify-content-between">
                <label>Только со скидкой</label>
                <div class="form-check form-switch p-0 m-0 d-flex align-items-center">
                    <input class="form-check-input m-0"
                           type="checkbox"
                           role="switch"
                           asp-for="OnlyWithDiscount"
                           id="flexSwitchCheckDefault"
                           style="height: 25px; width: 45px; cursor: pointer;"
                           onchange="this.form.submit()">
                </div>
            </div>

            <select class="flex-grow-1 form-control rounded-4 form-select" asp-for="SelectedSortVariable" asp-items="ViewBag.SortVariables" onchange="this.form.submit()">
                <option value="-1" disabled selected>Сортировка</option> <!-- Сортировка -->
                <option value="0">Все товары</option>
            </select>

            <div class="dropdown form-control p-0 m-0 flex-grow-1 rounded-4 h-25 form-select">
                <button class="btn w-100 d-flex align-items-center rounded-4"
                        id="dropdownMenuButton"
                        data-bs-toggle="dropdown">
                    Другие фильтры
                </button>

                <ul class="dropdown-menu w-100 rounded-4 shadow-sm p-2" aria-labelledby="dropdownMenuButton"> <!-- Фильтры -->
                    <li>
                        <div class="d-flex flex-column gap-2">
                            <select class="flex-grow-1 form-control rounded-4 form-select" asp-items="@ViewBag.Producers" asp-for="FilterProducer" onchange="this.form.submit()">
                                <option value="-1" disabled selected>Производитель</option> <!-- Фильтр по производителю -->
                                <option value="0">Все товары</option>
                            </select>

                            <select class="flex-grow-1 form-control rounded-4 form-select" asp-items="@ViewBag.Suppliers" asp-for="FilterSupplier" onchange="this.form.submit()">
                                <option value="-1" disabled selected>Поставщик</option> <!-- Фильтр по поставщику -->
                                <option value="0">Все товары</option>
                            </select>

                            <select class="flex-grow-1 form-control rounded-4 form-select" asp-items="@ViewBag.Categories" asp-for="FilterCategory" onchange="this.form.submit()">
                                <option value="-1" disabled selected>Категория</option> <!-- Фильтр по категории -->
                                <option value="0">Все товары</option>
                            </select>
                        </div>
                    </li>
                </ul>
            </div>

            <a class="btn btn-primary rounded-4" asp-page="Index">Сбросить</a>
        </div>
    </form>
</div>

<div class="row row-cols-md-4 g-4">
    @foreach (var product in Model.Products)
    {
        <div class="col" >
            <div class="card bg-light shadow-sm p-2 rounded-4 gap-2">
                <a class="d-flex flex-column gap-1 text-decoration-none" asp-page="Product">
                    <div class="d-flex align-items-center align-self-center p-2" style="height: 300px">
                        <img class="rounded-4 w-100" src="resources/product images/@product.ImageName" onerror="this.src='resources/product images/ProductError.png'; this.onerror=null;" style="object-fit: contain" />
                    </div>

                    <h3 class="align-self-center m-0 text-black">@product.Name</h3>

                    <div class="d-inline-flex gap-1 align-self-center align-items-center m-0">
                        @if (product.Discount > 0)
                        {
                            var discountedPrice = Math.Round(product.Price * ((100m - product.Discount) / 100m), 2);
                            <h3 class="text-danger fw-bold m-0">@discountedPrice</h3>
                            <del class="text-muted">@product.Price</del>
                        }
                        else
                        {
                            <h3 class="text-success fw-bold m-0">@product.Price</h3>
                        }
                    </div>
                </a>
                <form method="post">
                    <input type="hidden" name="article" value="@product.Article" />
                    <button class="btn btn-primary form-control rounded-4">Добавить в корзину</button>
                </form>
            </div>
        </div>
    }
</div>
